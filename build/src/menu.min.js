import{getStorage,putStorage}from"./storage.min.js";let storage_key,fields;export async function initMenu(e,t,n,o,i,r,l,d){const c=await getStorage();storage_key=i,fields=r,createWrapper(e,t,n,o,l);for(const e in c[storage_key])addKeyView(e,l);for(const e in fields)addFields(e,d)}function createWrapper(e,t,n,o,i){const r=document.createElement("div");r.classList.add("full"),r.classList.add("SYMenu"),r.innerHTML=`<div class="full flex-column" id="SYMenuWrapper1">\n\t\t<div class="h-box flex-row" style="background-color: grey; color: white; font-weight: bold;">\n\t\t\t<div class="grow border-bottom flex-row">${t}</div>\n\t\t\t<button class="row-button settings border center bg-img" title="Ayarlar"></button>\n\t\t</div>\n\t\t<div class="flex-column scroll-y grow" id="SYMenuContainer1"></div>\n\t\t<input class="border-bottom h-box" type="text" placeholder="${n}">\n\t\t<button class="border-bottom h-box">${o}</button>\n\t</div>\n\t\n\t<div class="full flex-column hidden" id="SYMenuWrapper2">\n\t\t<div class="h-box flex-row" style="background-color: grey; color: white; font-weight: bold;">\n\t\t\t<div class="grow border-bottom flex-row">Title</div>\n\t\t</div>\n\t\t<div class="flex-column scroll-y grow" id="SYMenuContainer2"></div>\n\t\t<button class="h-box reject center bg-img" title="Düzenlemeyi İptal Et"></button>\n\t\t<button class=" h-box confirm center bg-img" title="Düzenlemeyi Onayla"></button>\n\t</div>`;r.children[0].children[0].children[1].onclick=()=>{window.open(chrome.runtime.getURL("/settings/index.html"),"_blank",`width=${screen.width},height=${screen.height},top=0,left=0`)};const l=r.children[0].children[2],d=r.children[0].children[3];d.onclick=async()=>{handleClickNewButton(d,l,i)},e.append(r)}function addKeyView(e,t){let n=document.createElement("div");n.classList.add("h-box"),n.innerHTML=`<div class="h-box flex-row">\n\t\t<div class="grow border-bottom flex-row button">${e}</div>\n\t\t<button class="row-button edit border center bg-img" title="Düzenle"></button>\n\t\t<button class="row-button delete border center bg-img" title="Sil"></button>\n\t</div>`,n.children[0].children[0].addEventListener("click",(function(){handleClick(e,t)})),n.children[0].children[1].addEventListener("click",(function(){handleEdit(e)})),n.children[0].children[2].addEventListener("click",(function(){handleDelete(n,e)}));document.getElementById("SYMenuContainer1").append(n)}function addFields(e,t){const n="password"==e?{type:"password",title:"Göster",icon:"show"}:{type:"text",title:"Gizle",icon:"hide"};let o=document.createElement("div");o.classList.add("h-box"),o.innerHTML=`<div class="h-box flex-row">\n\t\t<input type="${n.type}" class="grow border-bottom" placeholder="${e}:">\n\t\t<button class="row-button dice border center bg-img" title="Rastgele"></button>\n\t\t<button class="row-button copy border center bg-img" title="Kopyala"></button>\n\t\t<button class="row-button ${n.icon} border center bg-img" title="${n.title}"></button>\n\t</div>`;const i=o.children[0].children[0],r=o.children[0].children[1],l=o.children[0].children[2],d=o.children[0].children[3];r.addEventListener("click",(function(){i.value=t()})),l.addEventListener("click",(function(){i.select(),navigator.clipboard.writeText(i.value),i.focus()})),d.addEventListener("click",(function(){"text"==i.type?(i.type="password",d.title="Göster",d.classList.remove("hide"),d.classList.add("show")):(i.type="text",d.title="Gizle",d.classList.add("hide"),d.classList.remove("show"))})),document.getElementById("SYMenuContainer2").append(o)}async function handleClickNewButton(e,t,n){try{let e=t.value;if(e=e.trim(),t.value="",null==e||""==e)return;let o=await getStorage();if(o[storage_key]||(o[storage_key]={}),o[storage_key][e])return;o[storage_key][e]=fields,await putStorage(o),addKeyView(e,n)}catch{}}async function handleClick(e,t){try{const n=await getStorage();t(e,n[storage_key][e])}catch{}}async function handleDelete(e,t){try{const n=await getStorage();if(delete n[storage_key][t],!await putStorage(n))return;e.parentElement.removeChild(e)}catch{}}async function handleEdit(e){try{const t=(await getStorage())[storage_key][e];document.getElementById("SYMenuWrapper2").children[0].innerHTML=e;let n=0;for(const e in fields)document.getElementById("SYMenuContainer2").children[n].children[0].children[0].value=t[e]??"",n++;document.getElementById("SYMenuWrapper2").children[2].onclick=()=>{handleReject()},document.getElementById("SYMenuWrapper2").children[3].onclick=()=>{handleConfirm(e)},document.getElementById("SYMenuWrapper1").classList.add("hidden"),document.getElementById("SYMenuWrapper2").classList.remove("hidden")}catch{}}async function handleConfirm(e){const t={};let n=0;for(const e in fields)t[e]=document.getElementById("SYMenuContainer2").children[n].children[0].children[0].value,n++;const o=await getStorage();o[storage_key]||(o[storage_key]={}),o[storage_key][e]=t,await putStorage(o),handleReject()}async function handleReject(){document.getElementById("SYMenuWrapper2").classList.add("hidden"),document.getElementById("SYMenuWrapper1").classList.remove("hidden")}